#!/bin/hush
#   ---------------------------------------------
#   Common settings
#   ---------------------------------------------
HOSTNAME=df3120
VERSION=0.0.1

BT_ADDRESS="84:59:04:04:02:05"

NFS_SERVER="192.168.178.10"

NFS_EXPORT="/exports/df3120-rootfs"

. /etc/init.d/functions.sh

hostname $HOSTNAME

header

#   ---------------------------------------------
#   MDEV Support
#   (Requires sysfs support in the kernel)
#   ---------------------------------------------
echo -n "* Mounting filesystems"
mkdir -p /dev/pts /dev/shm
mount -a
status $? 1

echo -n "* Creating devices"
/sbin/mdev -s
status $? 0

#echo 2 >/proc/cpu/alignment

#   ---------------------------------------------
#   start loggers
#   ---------------------------------------------
echo -n "* Starting syslogd"
/sbin/syslogd -C16
status $? 0

echo -n "* Starting klogd"
/sbin/klogd
status $? 0

#   ---------------------------------------------
#
#   ---------------------------------------------
echo "* Network usb0 172.16.61.2/24"

# see: http://www.tty1.net/blog/2010-04-21-ifconfig-ip-comparison_en.html
#      http://www.tecmint.com/ip-command-examples/

# loopback device
#ifconfig lo 127.0.0.1 up
ip link set lo up
ip addr add 127.0.0.1 dev lo

# 'usb0' device
ip link set usb0 up
ip addr add 172.16.61.2/24 dev usb0
ip route add default via 172.16.61.1 dev usb0

#   ---------------------------------------------
#   test of usb networking
#   ---------------------------------------------

networkAvailable=`isNetworkAvailable`

if ( $networkAvailable ); then

    mountNFS

    echo "* Starting network services -->"

    startUsbNetworkServices

    return

fi

bluez_init

bluez_connect

#echo "* Starting PAN connection"
#pand -c 00:11:F6:06:8B:AD
#sleep 1
#ifconfig bnep0 192.168.1.2

# Disable console blanking
printf "\e[9;0]" >/dev/tty0

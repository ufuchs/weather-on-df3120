#!/bin/hush
#   ---------------------------------------------
#   Common settings
#   ---------------------------------------------
HOSTNAME=df3120
VERSION=0.0.1

BT_ADDRESS="84:59:04:04:02:05"

NFS_SERVER="192.168.178.10"

NFS_EXPORT="/exports/df3120-rootfs"

hostname $HOSTNAME

_FUNCTIONS=/etc/init.d/functions.sh
[ -f ${_FUNCTIONS} ] && . ${_FUNCTIONS}

#   ---------------------------------------------
#   get verbose
#   ---------------------------------------------
echo
echo "    System initialization..."
echo
echo "    Hostname       : $HOSTNAME"
echo "    Filesystem     : v$VERSION"
echo
echo "    Kernel release : `uname -s` `uname -r`"
echo "    Kernel version : `uname -v`"
echo

#   ---------------------------------------------
#   MDEV Support
#   (Requires sysfs support in the kernel)
#   ---------------------------------------------
echo -n "* Mounting filesystems"
mkdir -p /dev/pts /dev/shm
mount -a
status $? 1

echo -n "* Creating devices"
/sbin/mdev -s
status $? 0

#echo 2 >/proc/cpu/alignment

#   ---------------------------------------------
#   start loggers
#   ---------------------------------------------
echo -n "* Starting syslogd"
/sbin/syslogd -C16
status $? 0

echo -n "* Starting klogd"
/sbin/klogd
status $? 0

#   ---------------------------------------------
#
#   ---------------------------------------------
echo "* Network usb0 172.16.61.2/24"
ifconfig lo 127.0.0.1 up

# see: http://www.tty1.net/blog/2010-04-21-ifconfig-ip-comparison_en.html
ifconfig usb0 172.16.61.2 netmask 255.255.255.0 up
route add default gw 172.16.61.1 usb0

#   ---------------------------------------------
#   test of usb networking
#   ---------------------------------------------

networkAvailable=`isNetworkAvailable`

if ( networkAvailable ); then
    echo "* Starting network services -->"
    startNetworkServices
fi



echo "* Starting Bluetooth"
hciattach -s 115200 /dev/ttySAC0 bcm2035 921600 flow 00:00:00:00:00 >/dev/null 2>&1

hciconfig hci0 up

#`echo $(hcitool dev) | cut -d' ' -f3`
#bdaddr $BT_ADDRESS
#hciconfig hci0 reset
hciconfig hci0 up
hciconfig hci0 class 0x020100
hciconfig hci0 name $HOSTNAME

#echo "* Starting PAN connection"
#pand -c 00:11:F6:06:8B:AD
#sleep 1
#ifconfig bnep0 192.168.1.2

# Disable console blanking
printf "\e[9;0]" >/dev/tty0

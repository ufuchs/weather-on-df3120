#!/bin/hush
#   ---------------------------------------------
#   Common settings
#   ---------------------------------------------
HOSTNAME=df3120
VERSION=0.0.1

BT_ADDRESS="84:59:04:04:02:05"

NFS_SERVER="192.168.178.10"

NFS_EXPORT="/exports/df3120-rootfs"

. /etc/init.d/functions.sh

hostname $HOSTNAME

header

#   ---------------------------------------------
#   mounting file systems
#   ---------------------------------------------
echo -n "* Mounting filesystems"
mkdir -p /dev/pts /dev/shm
mount -a
status $? 1

#   ---------------------------------------------
#   MDEV Support
#   ---------------------------------------------
echo -n "* Creating devices"
/sbin/mdev -s
status $? 0

mount / -o remount,rw

#echo 2 >/proc/cpu/alignment

#   ---------------------------------------------
#   start loggers
#   ---------------------------------------------
echo -n "* Starting syslogd"
/sbin/syslogd -C16
status $? 0

echo -n "* Starting klogd"
/sbin/klogd
status $? 0

#   ---------------------------------------------
#   inits the loopback device
#   ---------------------------------------------
ifconfig lo 127.0.0.1 up

#   ---------------------------------------------
#   inits the 'usb0' device
#   ---------------------------------------------
usb0_init

#   ---------------------------------------------
#   test of usb networking
#   ---------------------------------------------
networkAvailable=`isNetworkAvailable`

if ( $networkAvailable ); then

    echo "* Starting network services -->"

    startUsbNetworkServices

    start_apps

    exit 0

fi

kill -SIGTERM $(pidof udhcpc)

bluez_init

bluez_connect

#echo "* Starting PAN connection"
#pand -c 00:11:F6:06:8B:AD
#sleep 1
#ifconfig bnep0 192.168.1.2

# Disable console blanking
printf "\e[9;0]" >/dev/tty0

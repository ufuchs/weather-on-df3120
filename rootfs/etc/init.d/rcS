#!/bin/hush
#   ---------------------------------------------
#   Common settings
#   ---------------------------------------------
HOSTNAME=df3120
VERSION=0.0.1

hostname $HOSTNAME

#   ---------------------------------------------
#   prints execution status.
#
#   @param {$1} : Execution status
#   @param {$2} : Optional
#          Continue (0) or Abort (1) on error
#   ---------------------------------------------
status () {

    [ $1 -eq 0 ] && {
            echo    "[SUCCESS]"
        } || {
            echo    "[FAILED]"
           [ ${2:0} -eq 1 ] && {
               echo "... System init aborted."
               exit 1
           }
        }
}

#   ---------------------------------------------
#   get verbose
#   ---------------------------------------------
echo
echo "    System initialization..."
echo
echo "    Hostname       : $HOSTNAME"
echo "    Filesystem     : v$VERSION"
echo
echo "    Kernel release : `uname -s` `uname -r`"
echo "    Kernel version : `uname -v`"
echo

#   ---------------------------------------------
#   MDEV Support
#   (Requires sysfs support in the kernel)
#   ---------------------------------------------
echo -n "* Mounting filesystems"
mkdir -p /dev/pts /dev/shm
mount -a
status $? 1

echo -n "* Creating devices..."
/sbin/mdev -s
status $? 0

//echo 2 >/proc/cpu/alignment

# echo "* Starting system loggers..."
syslogd -C16
klogd


echo "* Network usb0 172.16.61.1/24"
ifconfig lo 127.0.0.1 up

#ifconfig usb0 172.16.61.1 netmask 255.255.255.0 up
#route add default gw 172.16.61.2 usb0

#echo "* mount /nfs"
#mount -t nfs -o nolock 192.168.178.10:/exports/df3120-rootfs /nfs

#ntpd -q -p 0.europe.pool.ntp.org
#hwclock -w
#export TZ=$(cat "/etc/TZ")

echo "* Starting telnetd..."
telnetd -l /bin/sh

echo "* Starting Bluetooth"
hciattach -s 115200 /dev/ttySAC0 bcm2035 921600 flow 00:00:00:00:00 >/dev/null 2>&1
hciconfig hci0 up
hciconfig hci0 class 0x020100
hciconfig hci0 name df3120


crond -c /etc/cron.d/crontabs

#echo "* fetching weather"
#/usr/local/bin/fetchWeather.sh

#echo "* Starting PAN connection"
#pand -c 00:11:F6:06:8B:AD
#sleep 1
#ifconfig bnep0 192.168.1.2

# Disable console blanking
printf "\e[9;0]" >/dev/tty0
